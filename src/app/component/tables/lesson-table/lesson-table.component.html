<div class="tableContainer">
  @if (isLoadingResults) {
  <app-spinner />
  }@else{
  <div class="title">
    <div class="titleContainer">
      <app-header-title [title]="'przedmioty'" />
    </div>

    <div class="buttonContainer">
      @if(!isOpenAddForm){
      <app-add-with-text-button (clicked)="addForm()" />
      }@else{
      <app-close-with-text-button (clicked)="closeForm()" />
      }
    </div>
  </div>
  @if(isOpenAddForm){
  <div class="addFrom">
    <app-add-lesson-form (addNewLesson)="addNewLesson($event)" />
  </div>
  }
  <table mat-table [dataSource]="lessonData">
    <form [formGroup]="lessonEdit">
      <ng-container matColumnDef="przedmiot">
        <th mat-header-cell *matHeaderCellDef>Przedmiot</th>
        <td mat-cell *matCellDef="let element">
          @if(element.id != activeForm){
          {{ element.subject.name }}} @else{
          <mat-form-field>
            <mat-label>Przedmiot</mat-label>
            <mat-select [formControl]="subjectValue">
              <mat-option></mat-option>
              @for (e of subject; track e) {
              <mat-option [value]="e.id">{{ e.name }}</mat-option>
              }
            </mat-select>
            <mat-error>{{ errorSubjectValueMessage() }}</mat-error>
          </mat-form-field>

          }
        </td>
      </ng-container>

      <ng-container matColumnDef="poziom">
        <th mat-header-cell *matHeaderCellDef>Poziom</th>
        <td mat-cell *matCellDef="let element">
          @if(element.id != activeForm){
          {{ element.subject_level.name }}} @else{<mat-form-field>
            <mat-label>Poziom</mat-label>
            <mat-select [formControl]="subjectLevelValue">
              <mat-option></mat-option>
              @for (e of subjectLevel; track e) {
              <mat-option [value]="e.id">{{ e.name }}</mat-option>
              }
            </mat-select>
            <mat-error>{{ errorSubjectLevelValueMessage() }}</mat-error>
          </mat-form-field>

          }
        </td>
      </ng-container>
      <ng-container matColumnDef="cena">
        <th mat-header-cell *matHeaderCellDef>Cena</th>
        <td mat-cell *matCellDef="let element">
          @if(element.id != activeForm){{{ element.price }}} @else{
          <mat-form-field>
            <input
              matInput
              type="number"
              placeholder="prcie"
              [formControl]="priceValue"
            />
            <mat-error>{{ errorPriceValueMessage() }}</mat-error>
          </mat-form-field>
          }
        </td>
      </ng-container>

      <ng-container matColumnDef="action">
        <th mat-header-cell *matHeaderCellDef>action</th>
        <td mat-cell *matCellDef="let element">
          @if(activeForm!=element.id){
          <app-edit-button
            (clicked)="
              edit(
                element.id,
                element.subject.id,
                element.subject_level.id,
                element.price
              )
            "
          /><app-delete-button (clicked)="delete(element.id)" /> }@else{
          <app-save-button (clicked)="onSubmit(element.id)" />
          <app-close-button (clicked)="close()" />}
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </form>
  </table>
  }
</div>
